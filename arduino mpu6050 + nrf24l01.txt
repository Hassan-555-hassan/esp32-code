#include <Wire.h>
#include <MPU6050.h>
#include <SPI.h>
#include <RF24.h>

// Ø¥Ø¹Ø¯Ø§Ø¯ NRF24L01
#define CE_PIN 9
#define CSN_PIN 8
RF24 radio(CE_PIN, CSN_PIN);
const byte address[6] = "00001";

// Ø¥Ø¹Ø¯Ø§Ø¯ MPU6050
MPU6050 mpu;

// LED Ù…ØªØµÙ„ Ø¹Ù„Ù‰ D10
#define LED_PIN 10

void setup() {
  Serial.begin(115200);
  pinMode(LED_PIN, OUTPUT);
  digitalWrite(LED_PIN, LOW);

  Serial.println("â³ Initializing Receiver...");

  // ØªÙ‡ÙŠØ¦Ø© NRF24L01
  if (!radio.begin()) {
    Serial.println("âŒ NRF24L01 not detected!");
    while (1);  // ØªÙˆÙ‚Ù Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬
  }

  radio.openReadingPipe(0, address);
  radio.setChannel(100);
  radio.setPALevel(RF24_PA_LOW);
  radio.setDataRate(RF24_1MBPS);
  radio.startListening();

  Serial.println("âœ… Receiver Ready. Listening...");

  // Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† NRF24 Ù†Ø¨Ø¯Ø£ ØªÙ‡ÙŠØ¦Ø© MPU6050
  Wire.begin();
  mpu.initialize();

  if (!mpu.testConnection()) {
    Serial.println("âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ MPU6050");
    while (1);  // ØªÙˆÙ‚Ù Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬
  }

  Serial.println("âœ… ØªÙ‡ÙŠØ¦Ø© MPU6050 ØªÙ… Ø¨Ù†Ø¬Ø§Ø­!");
}

void loop() {
  // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù…Ø±Ø³Ù„
  if (radio.available()) {
    char text[32] = "";
    radio.read(&text, sizeof(text));

    Serial.print("ðŸ“¥ Received: ");
    Serial.println(text);

    if (strcmp(text, "LIGHT") == 0) {
      digitalWrite(LED_PIN, HIGH);
      delay(500);
      digitalWrite(LED_PIN, LOW);
    }
  }

  // Ù‚Ø±Ø§Ø¡Ø© Ø¨ÙŠØ§Ù†Ø§Øª MPU6050
  int16_t ax, ay, az;
  int16_t gx, gy, gz;

  mpu.getAcceleration(&ax, &ay, &az);
  mpu.getRotation(&gx, &gy, &gz);

  // Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù‚ÙŠÙ…
  Serial.print("AX: "); Serial.print(ax);
  Serial.print(" AY: "); Serial.print(ay);
  Serial.print(" AZ: "); Serial.println(az);

  Serial.print("GX: "); Serial.print(gx);
  Serial.print(" GY: "); Serial.print(gy);
  Serial.print(" GZ: "); Serial.println(gz);

  // ØªØ´ØºÙŠÙ„ LED Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø­Ø±ÙƒØ© Ù‚ÙˆÙŠØ©
  if (abs(ax) > 3000) {
    digitalWrite(LED_PIN, HIGH);
  } else {
    digitalWrite(LED_PIN, LOW);
  }

  delay(500);
}
